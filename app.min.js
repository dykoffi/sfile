const createError=require("http-errors"),express=require("express"),logger=require("morgan"),cookieparser=require("cookie-parser"),path=require("path"),multer=require("multer"),cors=require("cors"),index=require("./routes"),connexion=require("./routes/connexion"),storage=multer.diskStorage({destination:function(e,r,o){o(null,"public/uploads/"+e.params.object)},filename:function(e,r,o){o(null,Date.now()+"-"+r.originalname)}}),upload=multer({storage:storage}),app=express();app.use(cors()),app.use(logger("dev")),app.use(express.json()),app.use(express.urlencoded({extended:!1})),app.use(express.static(path.join(__dirname,"public"))),app.use(cookieparser()),app.post("/upload/:object",upload.single("fichier"),((e,r)=>{r.json({file:e.file.path.replace("public","")})})),app.use("/",index),app.use("/connexion",connexion),app.use((function(e,r,o){o(createError(404))})),app.use((function(e,r,o,p){console.log(e.message)})),module.exports=app;
